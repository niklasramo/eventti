var r={ADD:"add",UPDATE:"update",IGNORE:"ignore",THROW:"throw"},E=class{constructor(t={}){this.dedupe=t.dedupe||r.ADD,this.getId=t.getId||(()=>Symbol()),this._events=new Map}_getListeners(t){let n=this._events.get(t);return n?.m?.size?n.l||(n.l=[...n.m.values()]):null}on(t,n,e){let i=this._events,s=i.get(t);s||(s={m:new Map,l:null},i.set(t,s));let d=s.m;if(e=e===void 0?this.getId(n):e,d.has(e))switch(this.dedupe){case r.THROW:throw new Error("Eventti: duplicate listener id!");case r.IGNORE:return e;case r.UPDATE:{s.l=null;break}default:d.delete(e),s.l=null}return d.set(e,n),s.l?.push(n),e}once(t,n,e){let i=!1;return e=e===void 0?this.getId(n):e,this.on(t,(...s)=>{i||(i=!0,this.off(t,e),n(...s))},e)}off(t,n){if(t===void 0){this._events.clear();return}if(n===void 0){this._events.delete(t);return}let e=this._events.get(t);e&&e.m.delete(n)&&(e.l=null,e.m.size||this._events.delete(t))}emit(t,...n){let e=this._getListeners(t);if(e){let i=e.length,s=0;if(n.length)for(;s<i;s++)e[s](...n);else for(;s<i;s++)e[s]()}}listenerCount(t){if(t===void 0){let n=0;return this._events.forEach(e=>{n+=e.m.size}),n}return this._events.get(t)?.m.size||0}};export{E as Emitter,r as EmitterDedupe};
